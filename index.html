<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ayan-Saver</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/ayancybers/ayan-saver/main/icon.png">

    <style>
        :root {
            --bg: #121212; --card-bg: #1e1e1e; --text: #ffffff;
            --primary: #3a7bd5; --success: #2ecc71; --warning: #f1c40f; --danger: #e74c3c;
        }
        .light-mode {
            --bg: #f0f2f5; --card-bg: #ffffff; --text: #1e3c72;
        }
        body {
            font-family: -apple-system, system-ui, sans-serif; background-color: var(--bg);
            color: var(--text); margin: 0; padding: 10px 10px 110px; transition: 0.3s;
        }
        .header {
            background: linear-gradient(135deg, #1e3c72, #2a5298); color: white;
            padding: 20px; border-radius: 20px; text-align: center; position: relative; margin-bottom: 15px;
        }
        .theme-toggle {
            position: absolute; top: 15px; left: 15px; background: rgba(255,255,255,0.2);
            border: none; color: white; padding: 8px 12px; border-radius: 12px;
        }
        .main-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .stat-card {
            background: var(--card-bg); padding: 12px; border-radius: 15px;
            text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .stat-card input {
            width: 85%; background: transparent; color: var(--text); border: none;
            border-bottom: 2px solid var(--primary); text-align: center; font-size: 1.1em; font-weight: bold; outline: none;
        }
        .bank-focus {
            grid-column: span 2; background: linear-gradient(145deg, #1e1e1e, #252525);
            border: 2px solid var(--primary);
        }
        .alert-card {
            grid-column: span 2; background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--warning); padding: 10px; border-radius: 15px; font-size: 0.9em;
        }
        .day-card { background: var(--card-bg); border-radius: 15px; padding: 15px; margin-bottom: 12px; border-right: 6px solid #555; }
        .day-card.completed { border-right-color: var(--success); }
        .input-group { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
        .input-group input { width: 90px; padding: 8px; border-radius: 10px; border: 1px solid #444; background: rgba(255,255,255,0.05); color: var(--text); text-align: center; }
        .prayer-row { display: flex; justify-content: space-around; background: rgba(255,255,255,0.05); padding: 12px; border-radius: 12px; }
        .prayer-item { display: flex; flex-direction: column; align-items: center; font-size: 0.8em; }
        .prayer-item input { width: 24px; height: 24px; margin-top: 6px; accent-color: var(--success); }
        .save-btn { position: fixed; bottom: 25px; left: 20px; right: 20px; background: var(--success); color: white; border: none; padding: 18px; border-radius: 20px; font-size: 1.2em; font-weight: bold; z-index: 1000; }
    </style>
</head>
<body>

<div class="header">
    <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ“</button>
    <h2 style="margin:0">Ayan-Saver ğŸ’°</h2>
</div>

<div class="main-stats">
    <div class="stat-card bank-focus">
        <span style="color: var(--primary); font-weight: bold;">ğŸ¦ Ø±ØµÙŠØ¯ Ø§Ù„Ø¨Ù†Ùƒ (ÙŠØªØ£Ø«Ø± Ø¨Ø§Ù„ØµØ±Ù)</span><br>
        <input type="number" id="bank_input" value="0" oninput="calc()" style="font-size: 1.8em; color: var(--text);">
        <div id="bank_live" style="font-size: 0.9em; margin-top: 5px; color: var(--success);"></div>
    </div>

    <div class="stat-card">
        <span>ğŸ’° Ø§Ù„Ø±Ø§ØªØ¨</span><br>
        <input type="number" id="salary" value="3000" oninput="calc()">
    </div>
    <div class="stat-card">
        <span>ğŸ¦ Ø§Ù„Ø§Ø¯Ø®Ø§Ø±</span><br>
        <input type="number" id="saving" value="500" oninput="calc()">
    </div>

    <div class="stat-card alert-card">
        <span>âš ï¸ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø§Ù„Ù…ÙØªØ±Ø¶ (Ø­Ø³Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª):</span>
        <span id="expected_net" style="font-weight: bold; color: var(--warning);">0</span>
        <div id="status_msg" style="font-size: 0.8em; margin-top: 5px;"></div>
    </div>
</div>

<div id="daysList"></div>
<button class="save-btn" onclick="saveToDevice()">Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âœ…</button>

<script>
    function toggleTheme() {
        document.body.classList.toggle('light-mode');
        localStorage.setItem('theme', document.body.classList.contains('light-mode') ? 'light' : 'dark');
    }

    const structure = [
        { month: 'Ø¯ÙŠØ³Ù…Ø¨Ø±', days: [29, 30, 31] },
        { month: 'ÙŠÙ†Ø§ÙŠØ±', days: Array.from({length: 31}, (_, i) => i + 1) }
    ];
    
    structure.forEach(m => {
        m.days.forEach(d => {
            let div = document.createElement('div');
            div.className = 'day-card';
            div.id = `d-${m.month}-${d}`;
            div.innerHTML = `
                <span style="font-weight:bold; color:var(--primary);">ğŸ“… ${d} ${m.month}</span>
                <div class="input-group">
                    <label>ØµØ±ÙØª Ø§Ù„ÙŠÙˆÙ…:</label>
                    <input type="number" class="day-exp" id="exp-${m.month}-${d}" placeholder="0" oninput="calc()">
                </div>
                <div class="prayer-row">
                    ${['ÙØ¬Ø±','Ø¸Ù‡Ø±','Ø¹ØµØ±','Ù…ØºØ±Ø¨','Ø¹Ø´Ø§Ø¡'].map((p, i) => `
                        <div class="prayer-item"><span>${p}</span><input type="checkbox" id="p-${i}-${m.month}-${d}" onchange="checkDay('${m.month}-${d}')"></div>
                    `).join('')}
                </div>
            `;
            document.getElementById('daysList').appendChild(div);
        });
    });

    function checkDay(id) {
        let card = document.getElementById(`d-${id}`);
        let checks = card.querySelectorAll('input[type="checkbox"]:checked').length;
        if(checks === 5) card.classList.add('completed');
        else card.classList.remove('completed');
    }

    function calc() {
        let bankInitial = parseFloat(document.getElementById('bank_input').value) || 0;
        let salary = parseFloat(document.getElementById('salary').value) || 0;
        let saving = parseFloat(document.getElementById('saving').value) || 0;
        let totalSpent = 0;
        document.querySelectorAll('.day-exp').forEach(i => totalSpent += parseFloat(i.value) || 0);

        // 1. Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø¨Ù†ÙƒÙŠ Ø§Ù„Ø­ÙŠ (ÙŠÙ†Ù‚Øµ Ù…Ù† Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù„ÙŠ Ø¯Ø®Ù„ØªÙ‡)
        let bankLive = bankInitial - totalSpent;
        document.getElementById('bank_live').innerText = "Ø§Ù„Ø¨Ø§Ù‚ÙŠ ÙØ¹Ù„ÙŠØ§Ù‹: " + bankLive + " Ø±ÙŠØ§Ù„";

        // 2. Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø§Ù„Ù…ÙØªØ±Ø¶ (Ø§Ù„Ù…Ù†Ø¨Ù‡)
        let expected = salary - saving - totalSpent;
        document.getElementById('expected_net').innerText = expected + " Ø±ÙŠØ§Ù„";

        // 3. Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
        let msg = document.getElementById('status_msg');
        if (bankInitial === salary - saving) {
            msg.innerText = "âœ… Ø­Ø³Ø§Ø¨Ø§ØªÙƒ Ø¯Ù‚ÙŠÙ‚Ø© Ø¬Ø¯Ø§Ù‹"; msg.style.color = "var(--success)";
        } else {
            msg.innerText = "ğŸ’¡ ØªØ°ÙƒØ±: Ø§Ù„Ø±ØµÙŠØ¯ ÙÙˆÙ‚ Ù‡Ùˆ Ù…Ø±Ø¬Ø¹ÙƒØŒ ÙˆØ§Ù„Ù…ØªØ¨Ù‚ÙŠ ØªØ­Øª Ù‡Ùˆ Ù‡Ø¯ÙÙƒ."; msg.style.color = "var(--warning)";
        }
    }

    function saveToDevice() {
        const data = {
            bank: document.getElementById('bank_input').value,
            salary: document.getElementById('salary').value,
            saving: document.getElementById('saving').value,
            expenses: Array.from(document.querySelectorAll('.day-exp')).map(i => ({id: i.id, val: i.value})),
            prayers: Array.from(document.querySelectorAll('input[type="checkbox"]')).map(c => ({id: c.id, val: c.checked}))
        };
        localStorage.setItem('ayanSaverFinal', JSON.stringify(data));
        alert('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­! ğŸš€');
    }

    window.onload = function() {
        if(localStorage.getItem('theme') === 'light') document.body.classList.add('light-mode');
        const saved = JSON.parse(localStorage.getItem('ayanSaverFinal'));
        if(saved) {
            document.getElementById('bank_input').value = saved.bank;
            document.getElementById('salary').value = saved.salary;
            document.getElementById('saving').value = saved.saving;
            saved.expenses.forEach(e => { if(document.getElementById(e.id)) document.getElementById(e.id).value = e.val; });
            saved.prayers.forEach(p => { if(document.getElementById(p.id)) document.getElementById(p.id).checked = p.val; });
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø£ÙŠØ§Ù…
            structure.forEach(m => m.days.forEach(d => checkDay(`${m.month}-${d}`)));
            calc();
        }
    };
</script>
</body>
</html>